<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üö® Arreglo de Emergencia - ReservaTuCancha</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .emergency-card {
            border: 3px solid #dc3545;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }
        .status-success { border-color: #28a745; box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3); }
        .status-error { border-color: #dc3545; box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3); }
    </style>
</head>
<body class="bg-light">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card emergency-card">
                    <div class="card-header bg-danger text-white text-center">
                        <h3><i class="fas fa-exclamation-triangle"></i> ARREGLO DE EMERGENCIA</h3>
                    </div>
                    <div class="card-body text-center">
                        <h5 class="mb-4">Crear Tabla de Usuarios y Usuarios Administradores</h5>
                        
                        <div id="status" class="mb-4">
                            <p class="text-muted">Haz clic en el bot√≥n para crear la tabla de usuarios y los usuarios administradores.</p>
                        </div>
                        
                        <button class="btn btn-danger btn-lg" onclick="runEmergencyFix()" id="fixButton">
                            <i class="fas fa-wrench"></i> EJECUTAR ARREGLO DE EMERGENCIA
                        </button>
                        
                        <div id="result" class="mt-4"></div>
                        
                        <div class="mt-4">
                            <h6>üîë Credenciales que se crear√°n:</h6>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="card bg-light">
                                        <div class="card-body">
                                            <strong>Super Admin</strong><br>
                                            <small>admin@reservatucancha.com<br>admin123</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card bg-light">
                                        <div class="card-body">
                                            <strong>MagnaSports</strong><br>
                                            <small>admin@magnasports.cl<br>magnasports2024</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card bg-light">
                                        <div class="card-body">
                                            <strong>Complejo Central</strong><br>
                                            <small>admin@complejocentral.cl<br>complejo2024</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function runEmergencyFix() {
            const button = document.getElementById('fixButton');
            const status = document.getElementById('status');
            const result = document.getElementById('result');
            
            // Deshabilitar bot√≥n y mostrar estado
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> EJECUTANDO...';
            status.innerHTML = '<div class="alert alert-info"><i class="fas fa-cog fa-spin"></i> Ejecutando arreglo de emergencia...</div>';
            result.innerHTML = '';
            
            // Llamar al endpoint de emergencia
            fetch('/api/emergency/fix-users')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        status.innerHTML = '<div class="alert alert-success"><i class="fas fa-check-circle"></i> ¬°Arreglo completado exitosamente!</div>';
                        result.innerHTML = `
                            <div class="alert alert-success">
                                <h6>‚úÖ Tabla usuarios creada</h6>
                                <p>Los usuarios administradores han sido creados. Ahora puedes hacer login en el panel de administrador.</p>
                                <hr>
                                <h6>üìã Salida del script:</h6>
                                <pre class="bg-dark text-light p-3 rounded">${data.output}</pre>
                            </div>
                        `;
                        
                        // Cambiar estilo de la tarjeta
                        document.querySelector('.emergency-card').classList.remove('status-error');
                        document.querySelector('.emergency-card').classList.add('status-success');
                        
                        button.innerHTML = '<i class="fas fa-check"></i> ARREGLO COMPLETADO';
                        button.classList.remove('btn-danger');
                        button.classList.add('btn-success');
                        
                    } else {
                        status.innerHTML = '<div class="alert alert-danger"><i class="fas fa-times-circle"></i> Error en el arreglo</div>';
                        result.innerHTML = `
                            <div class="alert alert-danger">
                                <h6>‚ùå Error ejecutando arreglo</h6>
                                <p><strong>Error:</strong> ${data.error}</p>
                                <p><strong>Mensaje:</strong> ${data.message}</p>
                            </div>
                        `;
                        
                        button.innerHTML = '<i class="fas fa-exclamation-triangle"></i> REINTENTAR';
                        button.disabled = false;
                    }
                })
                .catch(error => {
                    status.innerHTML = '<div class="alert alert-danger"><i class="fas fa-times-circle"></i> Error de conexi√≥n</div>';
                    result.innerHTML = `
                        <div class="alert alert-danger">
                            <h6>‚ùå Error de conexi√≥n</h6>
                            <p><strong>Error:</strong> ${error.message}</p>
                            <p>No se pudo conectar con el servidor.</p>
                        </div>
                    `;
                    
                    button.innerHTML = '<i class="fas fa-exclamation-triangle"></i> REINTENTAR';
                    button.disabled = false;
                });
        }
    </script>
</body>
</html>
