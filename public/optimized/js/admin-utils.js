function getAuthToken(){return localStorage.getItem("adminToken")}function getCurrentUser(){const e=localStorage.getItem("adminUser");return e?JSON.parse(e):null}function isAuthenticated(){return!!getAuthToken()}function logout(){localStorage.removeItem("adminToken"),localStorage.removeItem("adminUser"),window.location.href="admin-login.html"}function hasRole(e){const t=getCurrentUser();return t&&t.rol===e}function hasAnyRole(e){const t=getCurrentUser();return t&&e.includes(t.rol)}function getCurrentUserRole(){const e=getCurrentUser();return e?e.rol:null}function getCurrentUserComplex(){const e=getCurrentUser();return e?e.complejo_nombre:null}function canViewIncome(){return hasAnyRole(["super_admin","owner"])}function canViewOccupancy(){return hasAnyRole(["super_admin","owner"])}function canViewReports(){return hasAnyRole(["super_admin","owner"])}function canViewAllComplexes(){return hasRole("super_admin")}function canManageReservations(){return hasAnyRole(["super_admin","owner","manager"])}function hideElementsByRole(){const e=getCurrentUser();if(!e)return;if(!canViewIncome()){document.querySelectorAll('[data-role="income"]').forEach(e=>e.style.display="none")}if(!canViewOccupancy()){document.querySelectorAll('[data-role="occupancy"]').forEach(e=>e.style.display="none")}if(!canViewReports()){document.querySelectorAll('[data-role="reports"]').forEach(e=>e.style.display="none")}if(!canViewAllComplexes()){document.querySelectorAll('[data-role="complex-filter"]').forEach(e=>e.style.display="none")}document.querySelectorAll("[data-role]").forEach(t=>{const n=t.getAttribute("data-role");if(!["income","occupancy","reports","complex-filter"].includes(n))if(n.includes(",")){n.split(",").map(e=>e.trim()).includes(e.rol)||(t.style.display="none")}else"all-complexes"===n&&(canViewAllComplexes()||(t.style.display="none"))})}function updateUserInfo(){const e=getCurrentUser();if(!e)return;document.querySelectorAll('[data-user="name"]').forEach(t=>t.textContent=e.nombre);document.querySelectorAll('[data-user="role"]').forEach(t=>{const n=getRoleDisplayName(e.rol);t.textContent=n});document.querySelectorAll('[data-user="complex"]').forEach(t=>{t.textContent=e.complejo_nombre||"Todos los complejos"})}function getRoleDisplayName(e){return{super_admin:"Super Administrador",owner:"DueÃ±o de Complejo",manager:"Administrador de Complejo"}[e]||e}function getAuthHeaders(){return{"Content-Type":"application/json",Authorization:`Bearer ${getAuthToken()}`}}async function authenticatedFetch(e,t={}){const n={...getAuthHeaders(),...t.headers},o=e.startsWith("http")?e:`${API_BASE}${e}`,r=await fetch(o,{...t,headers:n});return 401===r.status||403===r.status?(logout(),null):r}function initializeRoleSystem(){return isAuthenticated()?(updateUserInfo(),hideElementsByRole(),!0):(window.location.href="admin-login.html",!1)}function setupLogout(){document.querySelectorAll('[data-action="logout"]').forEach(e=>{e.addEventListener("click",logout)})}window.AdminUtils={getAuthToken:getAuthToken,getCurrentUser:getCurrentUser,isAuthenticated:isAuthenticated,logout:logout,hasRole:hasRole,hasAnyRole:hasAnyRole,getCurrentUserRole:getCurrentUserRole,getCurrentUserComplex:getCurrentUserComplex,canViewIncome:canViewIncome,canViewOccupancy:canViewOccupancy,canViewReports:canViewReports,canViewAllComplexes:canViewAllComplexes,canManageReservations:canManageReservations,hideElementsByRole:hideElementsByRole,updateUserInfo:updateUserInfo,getRoleDisplayName:getRoleDisplayName,getAuthHeaders:getAuthHeaders,authenticatedFetch:authenticatedFetch,initializeRoleSystem:initializeRoleSystem,setupLogout:setupLogout};